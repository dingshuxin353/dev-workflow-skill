---
name: qa
description: 测试经理Skill，负责集成测试、回归测试和生成测试报告。当用户提到"开始测试"、"测试"、"@qa"、"验证功能"、"重测"时使用此skill。测试通过后引导用户验收，验收通过则更新README并合并到main/master分支。
---

# 测试经理 Skill

负责集成测试、回归测试和生成测试报告。

## 分支说明

主分支可能是 `main` 或 `master`，使用前先检测：
```bash
DEFAULT_BRANCH=$(git branch | grep -E '^\*?\s*(main|master)$' | head -1 | tr -d '* ')
```

## 工作模式

### 模式一：首次测试

触发：`@qa` 或 `开始测试`

1. 读取PRD和测试用例
2. 切换到test worktree，拉取最新代码
3. 执行所有测试用例
4. 生成测试报告

### 模式二：重新测试

触发：`@qa 重测`

1. 拉取最新代码
2. 验证已修复的Bug
3. 执行回归测试
4. 更新测试报告

## 测试报告

保存位置：`docs/test-reports/{feature-name}-{date}.md`

```markdown
# {功能名称} 测试报告

## 测试概要
- 测试时间：
- 测试环境：
- 测试版本：

## 测试结果汇总
| 指标 | 数值 |
|------|------|
| 总用例数 | |
| 通过数 | |
| 失败数 | |
| 通过率 | |

## 详细测试结果
| 用例ID | 用例名称 | 结果 | 备注 |
|--------|----------|------|------|

## Bug列表
| Bug ID | 描述 | 严重程度 | 状态 |
|--------|------|----------|------|

## 验收使用说明

### 环境配置
{列出需要配置的环境变量或配置文件}

**必填配置项**：
| 配置项 | 说明 | 示例 |
|--------|------|------|
| {KEY_NAME} | {用途说明} | {示例值} |

**配置方式**：
1. 复制 `.env.example` 为 `.env`
2. 填写必填配置项
3. {其他配置步骤}

### 验收步骤
1. {步骤1}
2. {步骤2}
3. {步骤3}

### 注意事项
- {注意事项1}
- {注意事项2}

## 测试结论
□ 通过，建议发布
□ 不通过，需修复后重测
```

## 验收使用说明编写要求

测试报告中的"验收使用说明"部分需要：

1. **环境配置**
   - 列出所有必填的环境变量/API Key
   - 说明每个配置项的用途
   - 提供配置示例（脱敏）
   - 说明配置文件位置和配置方式

2. **验收步骤**
   - 提供清晰的操作步骤
   - 包含预期结果
   - 面向非技术用户也能理解

3. **注意事项**
   - 常见问题提醒
   - 必须检查的关键点
   - 可能的错误和解决方案

## 结果处理

**测试通过**：
1. 更新状态为 `reviewing`
2. 提示用户验收
3. 用户输入"验收通过"后，执行发布流程

**测试不通过**：
1. 保持状态为 `testing`
2. 更新 `test_report_path`
3. 提示调用 `@dev 修复`

## 验收通过流程

当用户确认"验收通过"后，执行以下步骤：

### Step 1: 更新README

读取当前README.md，根据新功能更新使用说明：

```markdown
## 功能更新

### {feature-name}
{功能描述，面向GitHub用户的使用说明}

**使用方法**：
{使用示例}
```

确保README内容：
- 面向GitHub用户（外部用户）
- 说明新功能的用途
- 提供使用示例
- 语言简洁清晰

### Step 2: 提交README更新

```bash
git add README.md
git commit -m "docs: update README for {feature-name}"
```

### Step 3: 合并到主分支

```bash
# 检测主分支名称
DEFAULT_BRANCH=$(git branch | grep -E '^\*?\s*(main|master)$' | head -1 | tr -d '* ')

git checkout $DEFAULT_BRANCH
git merge test --no-ff -m "feat: merge {feature-name} from test"
```

### Step 4: 打版本标签（可选）

```bash
git tag v{version} -m "{feature-name} release"
```

### Step 5: 更新状态

更新 `.workflow-status.json` 状态为 `done`。

## 完整测试报告示例

```markdown
# 用户登录 测试报告

## 测试概要
- 测试时间：2026-02-05 17:30
- 测试环境：开发环境
- 测试版本：develop@abc1234

## 测试结果汇总
| 指标 | 数值 |
|------|------|
| 总用例数 | 15 |
| 通过数 | 15 |
| 失败数 | 0 |
| 通过率 | 100% |

## 验收使用说明

### 环境配置

**必填配置项**：
| 配置项 | 说明 | 示例 |
|--------|------|------|
| JWT_SECRET | JWT签名密钥 | your-secret-key-here |
| SMS_API_KEY | 短信服务API Key | sk-xxxx |
| WECHAT_APP_ID | 微信小程序AppID | wx1234567890 |

**配置方式**：
1. 复制 `.env.example` 为 `.env`
2. 填写上述必填配置项
3. 重启服务使配置生效

### 验收步骤
1. 访问 /login 页面
2. 测试用户名密码登录（测试账号：test/test123）
3. 测试手机号登录（需配置SMS_API_KEY）
4. 测试微信登录（需配置WECHAT_APP_ID）
5. 验证登录后跳转是否正确

### 注意事项
- SMS_API_KEY 必须配置，否则手机号登录功能不可用
- 微信登录需要在微信开放平台配置回调域名
- 首次登录会自动创建用户记录

## 测试结论
☑ 通过，建议发布
□ 不通过，需修复后重测
```
