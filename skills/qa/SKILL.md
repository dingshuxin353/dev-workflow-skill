---
name: qa
description: 测试经理Skill，负责集成测试、回归测试和生成测试报告。当用户提到"开始测试"、"测试"、"@qa"、"验证功能"、"重测"时使用此skill。测试通过后引导用户验收，验收通过则更新README并合并到main/master分支。
---

# 测试经理 Skill

负责集成测试、回归测试和生成测试报告。

## 分支说明

主分支可能是 `main` 或 `master`，使用前先检测：
```bash
DEFAULT_BRANCH=$(git branch | grep -E '^\*?\s*(main|master)$' | head -1 | tr -d '* ')
```

## 工作模式

### 模式一：首次测试

触发：`@qa` 或 `开始测试`

1. 读取PRD和测试用例
2. 切换到test worktree，拉取最新代码
3. 执行所有测试用例
4. 生成测试报告

### 模式二：重新测试

触发：`@qa 重测`

1. 拉取最新代码
2. 验证已修复的Bug
3. 验证已补充的设计
4. 执行回归测试
5. 更新测试报告

## 测试报告

保存位置：`docs/test-reports/{feature-name}-{date}.md`

```markdown
# {功能名称} 测试报告

## 测试概要
- 测试时间：
- 测试环境：
- 测试版本：

## 测试结果汇总
| 指标 | 数值 |
|------|------|
| 总用例数 | |
| 通过数 | |
| 失败数 | |
| 通过率 | |

## 详细测试结果
| 用例ID | 用例名称 | 结果 | 备注 |
|--------|----------|------|------|

## Bug列表
| Bug ID | 描述 | 严重程度 | 状态 |
|--------|------|----------|------|

## 设计缺陷列表
| 缺陷ID | 描述 | 类型 | 建议 | 状态 |
|--------|------|------|------|------|
| DESIGN-001 | {缺陷描述} | {交互/逻辑/体验} | {改进建议} | 待补充设计 |

## 验收使用说明

### 环境配置
{列出需要配置的环境变量或配置文件}

**必填配置项**：
| 配置项 | 说明 | 示例 |
|--------|------|------|
| {KEY_NAME} | {用途说明} | {示例值} |

**配置方式**：
1. 复制 `.env.example` 为 `.env`
2. 填写必填配置项
3. {其他配置步骤}

### 验收步骤
1. {步骤1}
2. {步骤2}
3. {步骤3}

### 注意事项
- {注意事项1}
- {注意事项2}

## 测试结论
□ 通过，建议发布
□ 不通过，存在Bug需修复（调用 @dev 修复）
□ 不通过，存在设计缺陷需补充（调用 @pm 补充设计）
```

## Bug vs 设计缺陷

**Bug（代码问题）**：
- 功能未按PRD实现
- 程序报错、崩溃
- 数据处理错误
- → 调用 `@dev 修复`

**设计缺陷（PRD问题）**：
- PRD未覆盖的边界场景
- 交互流程不合理
- 用户体验问题
- 业务逻辑漏洞
- → 调用 `@pm 补充设计`

## 设计缺陷记录要求

记录设计缺陷时需包含：

1. **缺陷ID**：DESIGN-001, DESIGN-002...
2. **描述**：清晰描述发现的问题
3. **类型**：
   - 交互：用户操作流程问题
   - 逻辑：业务规则不完整
   - 体验：用户体验不佳
   - 边界：未考虑的边界情况
4. **建议**：改进建议或解决方向
5. **状态**：待补充设计 / 已补充 / 不修复

## 结果处理

**测试通过**：
1. 更新状态为 `reviewing`
2. 提示用户验收

**存在Bug**：
1. 保持状态为 `testing`
2. 更新 `test_report_path`
3. 提示调用 `@dev 修复`

**存在设计缺陷**：
1. 保持状态为 `testing`
2. 更新 `test_report_path`
3. 提示调用 `@pm 补充设计`
4. 设计补充后需要 `@dev` 实现，再 `@qa 重测`

## 验收通过流程

当用户确认"验收通过"后，执行以下步骤：

### Step 1: 更新README

读取当前README.md，根据新功能更新使用说明（面向GitHub用户）。

### Step 2: 提交README更新

```bash
git add README.md
git commit -m "docs: update README for {feature-name}"
```

### Step 3: 合并到主分支

```bash
DEFAULT_BRANCH=$(git branch | grep -E '^\*?\s*(main|master)$' | head -1 | tr -d '* ')
git checkout $DEFAULT_BRANCH
git merge test --no-ff -m "feat: merge {feature-name} from test"
```

### Step 4: 打版本标签（可选）

```bash
git tag v{version} -m "{feature-name} release"
```

### Step 5: 更新状态

更新 `.workflow-status.json` 状态为 `done`。

## 完整测试报告示例

```markdown
# 用户登录 测试报告

## 测试概要
- 测试时间：2026-02-05 17:30
- 测试环境：开发环境
- 测试版本：develop@abc1234

## 测试结果汇总
| 指标 | 数值 |
|------|------|
| 总用例数 | 15 |
| 通过数 | 13 |
| 失败数 | 2 |
| 通过率 | 86.7% |

## Bug列表
| Bug ID | 描述 | 严重程度 | 状态 |
|--------|------|----------|------|
| BUG-001 | 密码错误提示文案不正确 | 中 | 待修复 |

## 设计缺陷列表
| 缺陷ID | 描述 | 类型 | 建议 | 状态 |
|--------|------|------|------|------|
| DESIGN-001 | 连续登录失败未限制次数 | 逻辑 | 建议5次失败后锁定账号15分钟 | 待补充设计 |
| DESIGN-002 | 密码输入无强度提示 | 体验 | 建议实时显示密码强度 | 待补充设计 |

## 验收使用说明

### 环境配置
**必填配置项**：
| 配置项 | 说明 | 示例 |
|--------|------|------|
| JWT_SECRET | JWT签名密钥 | your-secret-key-here |

### 验收步骤
1. 访问 /login 页面
2. 测试用户名密码登录

### 注意事项
- JWT_SECRET 必须配置

## 测试结论
□ 通过，建议发布
☑ 不通过，存在Bug需修复（调用 @dev 修复）
☑ 不通过，存在设计缺陷需补充（调用 @pm 补充设计）
```
