---
name: pm
description: 产品设计Skill，负责需求分析、PRD编写和测试用例设计。当用户提到"新需求"、"写PRD"、"产品设计"、"@pm"、"需求分析"、"补充设计"时使用此skill。支持根据产品排期、用户直接输入的需求、或测试报告中的设计缺陷进行设计。
---

# 产品设计 Skill

负责需求分析、PRD编写和测试用例设计。

## 输入来源

1. **从排期获取**：读取 `docs/sprint-plan.md` 中的需求
2. **直接输入**：用户直接描述需求
3. **从测试报告获取**：读取测试报告中的设计缺陷列表

## 工作模式

### 模式一：新需求设计

触发：`@pm` 或 `新需求`

1. 获取需求（从排期或直接输入）
2. 分析需求，提取核心功能点
3. 生成PRD和测试用例
4. 更新状态为 `planning`

### 模式二：补充设计

触发：`@pm 补充设计`

1. 读取测试报告 (`.workflow-status.json` 中的 `test_report_path`)
2. 提取设计缺陷列表
3. 针对每个设计缺陷补充PRD
4. 更新测试用例
5. 状态保持 `testing`，提示调用 `@dev` 实现

## 新需求设计流程

### Step 1: 获取需求

**方式一：从排期获取**
```
检查 docs/sprint-plan.md 是否存在
如存在，展示当前迭代的待开发需求列表
用户选择要设计的需求
```

**方式二：直接输入**
```
用户直接描述需求
分析需求，提取核心功能点
与用户确认功能边界
```

### Step 2: 生成PRD

PRD结构：
```markdown
# [功能名称] PRD

## 1. 需求背景
## 2. 目标用户
## 3. 功能描述
## 4. 用户故事
## 5. 功能清单
## 6. 接口设计（如需要）
## 7. 非功能需求
## 8. 验收标准
## 9. 开发任务清单
```

保存位置：`docs/prd/{feature-name}.md`

### Step 3: 生成测试用例

包含：正常流程测试、边界条件测试、异常场景测试

保存位置：`docs/test-cases/{feature-name}.md`

### Step 4: 更新状态

创建/更新 `.workflow-status.json`，状态设为 `planning`。

### Step 5: 确认并流转

用户确认后，状态更新为 `developing`，提示调用 `@dev`。

## 补充设计流程

### Step 1: 读取测试报告

```
读取 .workflow-status.json 获取 test_report_path
解析测试报告中的"设计缺陷列表"
```

### Step 2: 分析设计缺陷

展示设计缺陷列表：
```
【待补充的设计缺陷】
1. [DESIGN-001] 连续登录失败未限制次数
   类型：逻辑
   建议：建议5次失败后锁定账号15分钟

2. [DESIGN-002] 密码输入无强度提示
   类型：体验
   建议：建议实时显示密码强度
```

### Step 3: 补充PRD

针对每个设计缺陷，在PRD中补充：

```markdown
## 10. 补充设计（来自测试反馈）

### DESIGN-001: 登录失败次数限制
**问题**：连续登录失败未限制次数
**解决方案**：
- 同一账号连续登录失败5次后，锁定账号15分钟
- 锁定期间显示剩余解锁时间
- 锁定记录存储在Redis中

**新增功能点**：
- [ ] 登录失败计数器
- [ ] 账号锁定逻辑
- [ ] 锁定状态提示UI

### DESIGN-002: 密码强度提示
...
```

### Step 4: 更新测试用例

为补充的设计添加新的测试用例。

### Step 5: 通知开发

```
✅ 设计补充完成

【补充内容】
- DESIGN-001: 登录失败次数限制
- DESIGN-002: 密码强度提示

PRD已更新: docs/prd/user-login.md
测试用例已更新: docs/test-cases/user-login.md

请调用 @dev 实现补充的功能
```

## 命名规范

- 使用kebab-case：`user-login.md`
- 避免中文文件名

## 补充设计示例

```
用户: @pm 补充设计

PM Skill:
  📋 正在读取测试报告...

  已读取: docs/test-reports/user-login-20260205.md

  【待补充的设计缺陷】
  1. [DESIGN-001] 连续登录失败未限制次数
     类型：逻辑
     建议：建议5次失败后锁定账号15分钟

  2. [DESIGN-002] 密码输入无强度提示
     类型：体验
     建议：建议实时显示密码强度

  正在补充设计...

  ✅ 设计补充完成

  【DESIGN-001 解决方案】
  - 同一账号连续登录失败5次后锁定15分钟
  - 新增功能点：登录失败计数器、账号锁定逻辑、锁定提示UI

  【DESIGN-002 解决方案】
  - 密码输入时实时显示强度（弱/中/强）
  - 新增功能点：密码强度计算、强度指示器UI

  📄 PRD已更新: docs/prd/user-login.md
  📝 测试用例已更新: docs/test-cases/user-login.md

  请调用 @dev 实现补充的功能，完成后调用 @qa 重测
```
